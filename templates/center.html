<!DOCTYPE html>
<html>
<head>
    <title>Rescue Team {{ team_id }}</title>
    <style>
        body {
            font-family: Arial;
            background: #f7f7f7;
            padding: 20px;
        }
        .header {
            font-size: 26px;
            margin-bottom: 10px;
        }
        .log {
            background: white;
            padding: 12px;
            margin-bottom: 12px;
            border-radius: 8px;
            box-shadow: 0px 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>

<body>

    <div class="header">
        ðŸš‘ Rescue Team <b>{{ team_id }}</b>
    </div>

    <div id="logs">Loading logs...</div>

    <script>
    async function loadLogs() {
        const response = await fetch("/crash_log/{{ team_id }}");
        const logs = await response.json();

        const container = document.getElementById("logs");
        container.innerHTML = "";

        logs.forEach((log, i) => {
            const div = document.createElement("div");
            div.className = "log";
            div.innerHTML = `
                <b>Crash #${i + 1}</b><br>
                Driver Location: ${log.driver_lat}, ${log.driver_lon}<br>
                Assigned To: ${log.nearest_center}<br>
                <b>Time:</b> ${log.timestamp} (${timeAgo(log.timestamp)} ago)
            `;
            container.prepend(div);
        });
    }

    function timeAgo(ts) {
        const now = new Date();
        const past = new Date(ts);
        const diffSec = (now - past) / 1000;

        if (diffSec < 60) return `${Math.floor(diffSec)}s`;
        if (diffSec < 3600) return `${Math.floor(diffSec/60)}m`;
        if (diffSec < 86400) return `${Math.floor(diffSec/3600)}h`;
        return `${Math.floor(diffSec/86400)}d`;
    }

    setInterval(loadLogs, 2000);
    loadLogs();
    </script>

</body>
</html>
